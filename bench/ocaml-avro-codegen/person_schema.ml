(* generated by OCaml-avro schema compiler *)

module Str_map = Map.Make(String)

let schema = "{\"type\":\"record\",\"name\":\"Person\",\"fields\":[{\"type\":\"string\",\"name\":\"name\"},{\"type\":\"int\",\"name\":\"age\"},{\"type\":[\"null\",\"string\"],\"name\":\"email\"},{\"type\":{\"type\":\"array\",\"items\":\"string\"},\"name\":\"phone_numbers\"}]}"

type nonrec t = {
  name: string;
  age: int;
  email: string option;
  phone_numbers: string array;
}

let read (input:Avro.Input.t) : t =
  (let name = Avro.Input.read_string input in
   let age = Avro.Input.read_int input in
   let email =
     (let idx = Avro.Input.read_int input in if idx=0 then None
      else Some (Avro.Input.read_string input)) in
   let phone_numbers =
     (let readv input = Avro.Input.read_string input in
      Avro.Input.read_array readv input) in
   { name;age;email;phone_numbers })

let write (out:Avro.Output.t) (self:t) : unit =
  ((let self = self.name in Avro.Output.write_string out self);
    (let self = self.age in Avro.Output.write_int out self);
    (let self = self.email in
     (match self with
      | None -> Avro.Output.write_int out 0
      | Some self -> Avro.Output.write_int out 1; Avro.Output.write_string out self));
    (let self = self.phone_numbers in
     (let writev out self = Avro.Output.write_string out self in
      Avro.Output.write_array writev out self));
    )
